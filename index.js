// Generated by CoffeeScript 1.9.2
var R, fs, get, getPreset, isThere, nocomments, path, sourcegate;

require("source-map-support").install();

R = require("ramda");

fs = require("fs");

path = require("path");

isThere = require("is-there").sync;

sourcegate = require("sourcegate");

nocomments = require("strip-json-comments");

get = function(what, module) {
  var e, where;
  where = ["node_modules/" + what, "node_modules/" + module + "/node_modules/" + what];
  try {
    return JSON.parse(nocomments(fs.readFileSync(path.normalize(where[0])).toString()));
  } catch (_error) {
    try {
      return JSON.parse(nocomments(fs.readFileSync(path.normalize(where[1])).toString()));
    } catch (_error) {
      e = _error;
      console.error(e);
      throw new Error("Could not find preset at: " + where);
    }
  }
};

getPreset = function(tool, name, module) {
  var presets, ref;
  presets = {
    jscs: "jscs/presets",
    jshint: {
      airbnb: "airbnb-style/linters/jshintrc"
    },
    eslint: {
      airbnb: "airbnb-style/linters/eslintrc"
    }
  };
  if (tool === "jscs") {
    return get(presets.jscs + "/" + name + ".json", module);
  } else if (((ref = presets[tool]) != null ? ref[name] : void 0) != null) {
    return get(presets[tool][name], module);
  } else {
    return {};
  }
};

module.exports = function(o, gulp) {
  var base, config, empty, i, len, module, prefix, preset, ready, ref, ref1, res, sg, sources, watch;
  if (o == null) {
    o = {};
  }
  empty = [[], {}];
  if (R.is(Array, o.sourcegate)) {
    if (R.isEmpty(o.sourcegate)) {
      return [empty];
    }
  } else {
    return [empty];
  }
  ready = [];
  watch = [];
  ref = o.sourcegate;
  for (i = 0, len = ref.length; i < len; i++) {
    sg = ref[i];
    res = R.clone(empty);
    if (sg.sources == null) {
      sg.sources = ((ref1 = o.sourcegateRx) != null ? ref1[sg.recipe] : void 0) || [];
    } else if (!R.is(Array, sg.sources)) {
      sg.sources = [sg.sources];
    }
    if (sg.options == null) {
      sg.options = {};
    }
    if (sg.recipe == null) {
      res = [sg.sources, sg.options];
    } else {
      sources = [];
      config = "node_modules";
      module = sg.module || o.sourcegateModule;
      prefix = sg.prefix || o.sourcegatePrefix || '';
      preset = sg.preset || o.sourcegatePreset;
      if (module) {
        if (preset != null) {
          sources.push(getPreset(sg.recipe, preset, module));
        }
        config = path.normalize(config + "/" + module + "/" + prefix + sg.recipe + "rc");
        if (isThere(config)) {
          if (o.sourcegateWatch) {
            watch.push(config);
          }
          sources.push(config);
        }
        if ((base = sg.options).write == null) {
          base.write = {};
        }
        sg.options.write.path = "." + sg.recipe + "rc";
      }
      res = [sources.concat(sg.sources), sg.options];
    }
    ready.push(res);
  }
  if (gulp != null) {
    gulp.task("sourcegate", "Write sourcegate targets.", function() {
      var j, len1, results;
      results = [];
      for (j = 0, len1 = ready.length; j < len1; j++) {
        sg = ready[j];
        results.push(sourcegate.apply(null, sg));
      }
      return results;
    });
    if (o.sourcegateWatch) {
      gulp.task("sourcegate:watch", "Watch sourcegate sources for changes.", function() {
        return gulp.watch(watch, ["sourcegate"]);
      });
    }
  }
  return ready;
};

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5kZXguY29mZmVlIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiaW5kZXguY29mZmVlIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFHQSxJQUFBLDREQUFBOztBQUFBLE9BQUEsQ0FBUSxvQkFBUixDQUE2QixDQUFDLE9BQTlCLENBQUEsQ0FBQSxDQUFBOztBQUFBLENBQ0EsR0FBSSxPQUFBLENBQVEsT0FBUixDQURKLENBQUE7O0FBQUEsRUFFQSxHQUFLLE9BQUEsQ0FBUSxJQUFSLENBRkwsQ0FBQTs7QUFBQSxJQUdBLEdBQU8sT0FBQSxDQUFRLE1BQVIsQ0FIUCxDQUFBOztBQUFBLE9BSUEsR0FBVSxPQUFBLENBQVEsVUFBUixDQUFtQixDQUFDLElBSjlCLENBQUE7O0FBQUEsVUFLQSxHQUFhLE9BQUEsQ0FBUSxZQUFSLENBTGIsQ0FBQTs7QUFBQSxVQU1BLEdBQWEsT0FBQSxDQUFRLHFCQUFSLENBTmIsQ0FBQTs7QUFBQSxHQVNBLEdBQU0sU0FBQyxJQUFELEVBQU8sTUFBUCxHQUFBO0FBQ0osTUFBQSxRQUFBO0FBQUEsRUFBQSxLQUFBLEdBQVEsQ0FDTixlQUFBLEdBQWdCLElBRFYsRUFFTixlQUFBLEdBQWdCLE1BQWhCLEdBQXVCLGdCQUF2QixHQUF1QyxJQUZqQyxDQUFSLENBQUE7QUFLQTtXQUNFLElBQUksQ0FBQyxLQUFMLENBQVcsVUFBQSxDQUFXLEVBQUUsQ0FBQyxZQUFILENBQWdCLElBQUksQ0FBQyxTQUFMLENBQWUsS0FBTSxDQUFBLENBQUEsQ0FBckIsQ0FBaEIsQ0FBd0MsQ0FBQyxRQUF6QyxDQUFBLENBQVgsQ0FBWCxFQURGO0dBQUEsY0FBQTtBQUdFO2FBQ0UsSUFBSSxDQUFDLEtBQUwsQ0FBVyxVQUFBLENBQVcsRUFBRSxDQUFDLFlBQUgsQ0FBZ0IsSUFBSSxDQUFDLFNBQUwsQ0FBZSxLQUFNLENBQUEsQ0FBQSxDQUFyQixDQUFoQixDQUF3QyxDQUFDLFFBQXpDLENBQUEsQ0FBWCxDQUFYLEVBREY7S0FBQSxjQUFBO0FBR0UsTUFESSxVQUNKLENBQUE7QUFBQSxNQUFBLE9BQU8sQ0FBQyxLQUFSLENBQWMsQ0FBZCxDQUFBLENBQUE7QUFDQSxZQUFVLElBQUEsS0FBQSxDQUFNLDRCQUFBLEdBQTZCLEtBQW5DLENBQVYsQ0FKRjtLQUhGO0dBTkk7QUFBQSxDQVROLENBQUE7O0FBQUEsU0F5QkEsR0FBWSxTQUFDLElBQUQsRUFBTyxJQUFQLEVBQWEsTUFBYixHQUFBO0FBQ1YsTUFBQSxZQUFBO0FBQUEsRUFBQSxPQUFBLEdBQ0U7QUFBQSxJQUFBLElBQUEsRUFBTSxjQUFOO0FBQUEsSUFDQSxNQUFBLEVBQ0U7QUFBQSxNQUFBLE1BQUEsRUFBUSwrQkFBUjtLQUZGO0FBQUEsSUFHQSxNQUFBLEVBQ0U7QUFBQSxNQUFBLE1BQUEsRUFBUSwrQkFBUjtLQUpGO0dBREYsQ0FBQTtBQU9BLEVBQUEsSUFBRyxJQUFBLEtBQVEsTUFBWDtXQUNFLEdBQUEsQ0FBTyxPQUFPLENBQUMsSUFBVCxHQUFjLEdBQWQsR0FBaUIsSUFBakIsR0FBc0IsT0FBNUIsRUFBb0MsTUFBcEMsRUFERjtHQUFBLE1BRUssSUFBRyw0REFBSDtXQUNILEdBQUEsQ0FBSSxPQUFRLENBQUEsSUFBQSxDQUFNLENBQUEsSUFBQSxDQUFsQixFQUF5QixNQUF6QixFQURHO0dBQUEsTUFBQTtXQUVBLEdBRkE7R0FWSztBQUFBLENBekJaLENBQUE7O0FBQUEsTUF3Q00sQ0FBQyxPQUFQLEdBQWlCLFNBQUMsQ0FBRCxFQUFTLElBQVQsR0FBQTtBQUNmLE1BQUEsOEZBQUE7O0lBRGdCLElBQUk7R0FDcEI7QUFBQSxFQUFBLEtBQUEsR0FBUSxDQUFDLEVBQUQsRUFBSyxFQUFMLENBQVIsQ0FBQTtBQUNBLEVBQUEsSUFBRyxDQUFDLENBQUMsRUFBRixDQUFLLEtBQUwsRUFBWSxDQUFDLENBQUMsVUFBZCxDQUFIO0FBQ0UsSUFBQSxJQUFHLENBQUMsQ0FBQyxPQUFGLENBQVUsQ0FBQyxDQUFDLFVBQVosQ0FBSDtBQUFnQyxhQUFPLENBQUMsS0FBRCxDQUFQLENBQWhDO0tBREY7R0FBQSxNQUFBO0FBRUssV0FBTyxDQUFDLEtBQUQsQ0FBUCxDQUZMO0dBREE7QUFBQSxFQUlBLEtBQUEsR0FBUSxFQUpSLENBQUE7QUFBQSxFQUtBLEtBQUEsR0FBUSxFQUxSLENBQUE7QUFPQTtBQUFBLE9BQUEscUNBQUE7Z0JBQUE7QUFDRSxJQUFBLEdBQUEsR0FBTSxDQUFDLENBQUMsS0FBRixDQUFRLEtBQVIsQ0FBTixDQUFBO0FBQ0EsSUFBQSxJQUFPLGtCQUFQO0FBQ0UsTUFBQSxFQUFFLENBQUMsT0FBSCwwQ0FBNkIsQ0FBQSxFQUFFLENBQUMsTUFBSCxXQUFoQixJQUE4QixFQUEzQyxDQURGO0tBQUEsTUFFSyxJQUFBLENBQUEsQ0FBUSxDQUFDLEVBQUYsQ0FBSyxLQUFMLEVBQVksRUFBRSxDQUFDLE9BQWYsQ0FBUDtBQUNILE1BQUEsRUFBRSxDQUFDLE9BQUgsR0FBYSxDQUFDLEVBQUUsQ0FBQyxPQUFKLENBQWIsQ0FERztLQUhMOztNQUtBLEVBQUUsQ0FBQyxVQUFXO0tBTGQ7QUFPQSxJQUFBLElBQU8saUJBQVA7QUFDRSxNQUFBLEdBQUEsR0FBTSxDQUFDLEVBQUUsQ0FBQyxPQUFKLEVBQWEsRUFBRSxDQUFDLE9BQWhCLENBQU4sQ0FERjtLQUFBLE1BQUE7QUFJRSxNQUFBLE9BQUEsR0FBVSxFQUFWLENBQUE7QUFBQSxNQUNBLE1BQUEsR0FBUyxjQURULENBQUE7QUFBQSxNQUVBLE1BQUEsR0FBUyxFQUFFLENBQUMsTUFBSCxJQUFhLENBQUMsQ0FBQyxnQkFGeEIsQ0FBQTtBQUFBLE1BR0EsTUFBQSxHQUFTLEVBQUUsQ0FBQyxNQUFILElBQWEsQ0FBQyxDQUFDLGdCQUFmLElBQW1DLEVBSDVDLENBQUE7QUFBQSxNQUlBLE1BQUEsR0FBUyxFQUFFLENBQUMsTUFBSCxJQUFhLENBQUMsQ0FBQyxnQkFKeEIsQ0FBQTtBQUtBLE1BQUEsSUFBRyxNQUFIO0FBQ0UsUUFBQSxJQUFxRCxjQUFyRDtBQUFBLFVBQUEsT0FBTyxDQUFDLElBQVIsQ0FBYSxTQUFBLENBQVUsRUFBRSxDQUFDLE1BQWIsRUFBcUIsTUFBckIsRUFBNkIsTUFBN0IsQ0FBYixDQUFBLENBQUE7U0FBQTtBQUFBLFFBQ0EsTUFBQSxHQUFTLElBQUksQ0FBQyxTQUFMLENBQWtCLE1BQUQsR0FBUSxHQUFSLEdBQVcsTUFBWCxHQUFrQixHQUFsQixHQUFxQixNQUFyQixHQUE4QixFQUFFLENBQUMsTUFBakMsR0FBd0MsSUFBekQsQ0FEVCxDQUFBO0FBRUEsUUFBQSxJQUFHLE9BQUEsQ0FBUSxNQUFSLENBQUg7QUFDRSxVQUFBLElBQUcsQ0FBQyxDQUFDLGVBQUw7QUFDRSxZQUFBLEtBQUssQ0FBQyxJQUFOLENBQVcsTUFBWCxDQUFBLENBREY7V0FBQTtBQUFBLFVBRUEsT0FBTyxDQUFDLElBQVIsQ0FBYSxNQUFiLENBRkEsQ0FERjtTQUZBOztjQU1VLENBQUMsUUFBUztTQU5wQjtBQUFBLFFBT0EsRUFBRSxDQUFDLE9BQU8sQ0FBQyxLQUFLLENBQUMsSUFBakIsR0FBd0IsR0FBQSxHQUFJLEVBQUUsQ0FBQyxNQUFQLEdBQWMsSUFQdEMsQ0FERjtPQUxBO0FBQUEsTUFlQSxHQUFBLEdBQU0sQ0FBQyxPQUFPLENBQUMsTUFBUixDQUFlLEVBQUUsQ0FBQyxPQUFsQixDQUFELEVBQTZCLEVBQUUsQ0FBQyxPQUFoQyxDQWZOLENBSkY7S0FQQTtBQUFBLElBNEJBLEtBQUssQ0FBQyxJQUFOLENBQVcsR0FBWCxDQTVCQSxDQURGO0FBQUEsR0FQQTtBQXNDQSxFQUFBLElBQUcsWUFBSDtBQUNFLElBQUEsSUFBSSxDQUFDLElBQUwsQ0FBVSxZQUFWLEVBQXdCLDJCQUF4QixFQUFxRCxTQUFBLEdBQUE7QUFDbkQsVUFBQSxnQkFBQTtBQUFBO1dBQUEseUNBQUE7c0JBQUE7QUFDRSxxQkFBQSxVQUFVLENBQUMsS0FBWCxDQUFpQixJQUFqQixFQUF1QixFQUF2QixFQUFBLENBREY7QUFBQTtxQkFEbUQ7SUFBQSxDQUFyRCxDQUFBLENBQUE7QUFHQSxJQUFBLElBQUcsQ0FBQyxDQUFDLGVBQUw7QUFDRSxNQUFBLElBQUksQ0FBQyxJQUFMLENBQVUsa0JBQVYsRUFDRSx1Q0FERixFQUMyQyxTQUFBLEdBQUE7ZUFDdkMsSUFBSSxDQUFDLEtBQUwsQ0FBVyxLQUFYLEVBQWtCLENBQUMsWUFBRCxDQUFsQixFQUR1QztNQUFBLENBRDNDLENBQUEsQ0FERjtLQUpGO0dBdENBO1NBK0NBLE1BaERlO0FBQUEsQ0F4Q2pCLENBQUEiLCJzb3VyY2VzQ29udGVudCI6WyIjIFRPRE86IG1vdmUgZG9jdW1lbnRhdGlvbiBwZXJ0YWluaW5nIHRvIHRoaXMgZnJvbSBvcmxpbi9iZXZlcmFnZVxuIyBhcyBndWxwIGlzIG9wdGlvbmFsLCBkb2N1bWVudCB3aGljaCBvcHRpb25zIGFyZSBndWxwLXNwZWNpZmljXG5cbnJlcXVpcmUoXCJzb3VyY2UtbWFwLXN1cHBvcnRcIikuaW5zdGFsbCgpXG5SID0gcmVxdWlyZShcInJhbWRhXCIpXG5mcyA9IHJlcXVpcmUoXCJmc1wiKVxucGF0aCA9IHJlcXVpcmUoXCJwYXRoXCIpXG5pc1RoZXJlID0gcmVxdWlyZShcImlzLXRoZXJlXCIpLnN5bmNcbnNvdXJjZWdhdGUgPSByZXF1aXJlKFwic291cmNlZ2F0ZVwiKVxubm9jb21tZW50cyA9IHJlcXVpcmUoXCJzdHJpcC1qc29uLWNvbW1lbnRzXCIpXG5cblxuZ2V0ID0gKHdoYXQsIG1vZHVsZSkgLT5cbiAgd2hlcmUgPSBbXG4gICAgXCJub2RlX21vZHVsZXMvI3t3aGF0fVwiLFxuICAgIFwibm9kZV9tb2R1bGVzLyN7bW9kdWxlfS9ub2RlX21vZHVsZXMvI3t3aGF0fVwiXG4gIF1cblxuICB0cnlcbiAgICBKU09OLnBhcnNlIG5vY29tbWVudHMgZnMucmVhZEZpbGVTeW5jKHBhdGgubm9ybWFsaXplIHdoZXJlWzBdKS50b1N0cmluZygpXG4gIGNhdGNoXG4gICAgdHJ5XG4gICAgICBKU09OLnBhcnNlIG5vY29tbWVudHMgZnMucmVhZEZpbGVTeW5jKHBhdGgubm9ybWFsaXplIHdoZXJlWzFdKS50b1N0cmluZygpXG4gICAgY2F0Y2ggZVxuICAgICAgY29uc29sZS5lcnJvcihlKVxuICAgICAgdGhyb3cgbmV3IEVycm9yIFwiQ291bGQgbm90IGZpbmQgcHJlc2V0IGF0OiAje3doZXJlfVwiXG5cblxuZ2V0UHJlc2V0ID0gKHRvb2wsIG5hbWUsIG1vZHVsZSkgLT5cbiAgcHJlc2V0cyA9XG4gICAganNjczogXCJqc2NzL3ByZXNldHNcIiAje3ByZXNldH0uanNvbiB3aWxsIGJlIGFwcGVuZGVkXG4gICAganNoaW50OlxuICAgICAgYWlyYm5iOiBcImFpcmJuYi1zdHlsZS9saW50ZXJzL2pzaGludHJjXCJcbiAgICBlc2xpbnQ6XG4gICAgICBhaXJibmI6IFwiYWlyYm5iLXN0eWxlL2xpbnRlcnMvZXNsaW50cmNcIlxuXG4gIGlmIHRvb2wgaXMgXCJqc2NzXCJcbiAgICBnZXQoXCIje3ByZXNldHMuanNjc30vI3tuYW1lfS5qc29uXCIsIG1vZHVsZSlcbiAgZWxzZSBpZiBwcmVzZXRzW3Rvb2xdP1tuYW1lXT9cbiAgICBnZXQocHJlc2V0c1t0b29sXVtuYW1lXSwgbW9kdWxlKVxuICBlbHNlIHt9XG5cblxubW9kdWxlLmV4cG9ydHMgPSAobyA9IHt9LCBndWxwKSAtPlxuICBlbXB0eSA9IFtbXSwge31dXG4gIGlmIFIuaXMoQXJyYXksIG8uc291cmNlZ2F0ZSlcbiAgICBpZiBSLmlzRW1wdHkoby5zb3VyY2VnYXRlKSB0aGVuIHJldHVybiBbZW1wdHldXG4gIGVsc2UgcmV0dXJuIFtlbXB0eV0gIyBvciB0aHJvdz9cbiAgcmVhZHkgPSBbXVxuICB3YXRjaCA9IFtdXG5cbiAgZm9yIHNnIGluIG8uc291cmNlZ2F0ZVxuICAgIHJlcyA9IFIuY2xvbmUoZW1wdHkpXG4gICAgdW5sZXNzIHNnLnNvdXJjZXM/XG4gICAgICBzZy5zb3VyY2VzID0gby5zb3VyY2VnYXRlUng/W3NnLnJlY2lwZV0gfHwgW11cbiAgICBlbHNlIHVubGVzcyBSLmlzKEFycmF5LCBzZy5zb3VyY2VzKVxuICAgICAgc2cuc291cmNlcyA9IFtzZy5zb3VyY2VzXVxuICAgIHNnLm9wdGlvbnMgPz0ge31cblxuICAgIHVubGVzcyBzZy5yZWNpcGU/XG4gICAgICByZXMgPSBbc2cuc291cmNlcywgc2cub3B0aW9uc11cblxuICAgIGVsc2VcbiAgICAgIHNvdXJjZXMgPSBbXVxuICAgICAgY29uZmlnID0gXCJub2RlX21vZHVsZXNcIlxuICAgICAgbW9kdWxlID0gc2cubW9kdWxlIHx8IG8uc291cmNlZ2F0ZU1vZHVsZVxuICAgICAgcHJlZml4ID0gc2cucHJlZml4IHx8IG8uc291cmNlZ2F0ZVByZWZpeCB8fCAnJ1xuICAgICAgcHJlc2V0ID0gc2cucHJlc2V0IHx8IG8uc291cmNlZ2F0ZVByZXNldFxuICAgICAgaWYgbW9kdWxlXG4gICAgICAgIHNvdXJjZXMucHVzaCBnZXRQcmVzZXQoc2cucmVjaXBlLCBwcmVzZXQsIG1vZHVsZSkgaWYgcHJlc2V0P1xuICAgICAgICBjb25maWcgPSBwYXRoLm5vcm1hbGl6ZShcIiN7Y29uZmlnfS8je21vZHVsZX0vI3twcmVmaXh9I3tzZy5yZWNpcGV9cmNcIilcbiAgICAgICAgaWYgaXNUaGVyZSBjb25maWdcbiAgICAgICAgICBpZiBvLnNvdXJjZWdhdGVXYXRjaFxuICAgICAgICAgICAgd2F0Y2gucHVzaCBjb25maWdcbiAgICAgICAgICBzb3VyY2VzLnB1c2ggY29uZmlnXG4gICAgICAgIHNnLm9wdGlvbnMud3JpdGUgPz0ge31cbiAgICAgICAgc2cub3B0aW9ucy53cml0ZS5wYXRoID0gXCIuI3tzZy5yZWNpcGV9cmNcIlxuXG4gICAgICByZXMgPSBbc291cmNlcy5jb25jYXQoc2cuc291cmNlcyksIHNnLm9wdGlvbnNdXG5cbiAgICByZWFkeS5wdXNoIHJlc1xuXG4gIGlmIGd1bHA/XG4gICAgZ3VscC50YXNrIFwic291cmNlZ2F0ZVwiLCBcIldyaXRlIHNvdXJjZWdhdGUgdGFyZ2V0cy5cIiwgLT5cbiAgICAgIGZvciBzZyBpbiByZWFkeVxuICAgICAgICBzb3VyY2VnYXRlLmFwcGx5KG51bGwsIHNnKVxuICAgIGlmIG8uc291cmNlZ2F0ZVdhdGNoXG4gICAgICBndWxwLnRhc2sgXCJzb3VyY2VnYXRlOndhdGNoXCIsXG4gICAgICAgIFwiV2F0Y2ggc291cmNlZ2F0ZSBzb3VyY2VzIGZvciBjaGFuZ2VzLlwiLCAtPlxuICAgICAgICAgIGd1bHAud2F0Y2ggd2F0Y2gsIFtcInNvdXJjZWdhdGVcIl1cblxuICByZWFkeVxuIl19