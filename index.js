// Generated by CoffeeScript 1.9.2
var R, fs, get, getPreset, isThere, nocomments, path, sourcegate;

require("source-map-support").install();

R = require("ramda");

fs = require("fs");

path = require("path");

isThere = require("is-there").sync;

sourcegate = require("sourcegate");

nocomments = require("strip-json-comments");

get = function(what, module) {
  var e, where;
  where = ["node_modules/" + what, "node_modules/" + module + "/node_modules/" + what];
  try {
    return JSON.parse(nocomments(fs.readFileSync(path.normalize(where[0])).toString()));
  } catch (_error) {
    try {
      return JSON.parse(nocomments(fs.readFileSync(path.normalize(where[1])).toString()));
    } catch (_error) {
      e = _error;
      console.error(e);
      throw new Error("Could not find preset at: " + where);
    }
  }
};

getPreset = function(tool, name, module) {
  var presets, ref;
  presets = {
    jscs: "jscs/presets",
    jshint: {
      airbnb: "airbnb-style/linters/jshintrc"
    },
    eslint: {
      airbnb: "airbnb-style/linters/eslintrc"
    }
  };
  if (tool === "jscs") {
    return get(presets.jscs + "/" + name + ".json", module);
  } else if (tool === "coffeelint" && name === "coffeescript-style-guide") {
    return get("coffeescript-style-guide/coffeelint.json", module);
  } else if (((ref = presets[tool]) != null ? ref[name] : void 0) != null) {
    return get(presets[tool][name], module);
  } else {
    return {};
  }
};

module.exports = function(o, gulp) {
  var base, config, empty, filerc, i, len, module, prefix, preset, ready, ref, ref1, res, sg, sources, watch;
  if (o == null) {
    o = {};
  }
  empty = [[], {}];
  if (R.is(Array, o.sourcegate)) {
    if (R.isEmpty(o.sourcegate)) {
      return [empty];
    }
  } else {
    return [empty];
  }
  ready = [];
  watch = [];
  ref = o.sourcegate;
  for (i = 0, len = ref.length; i < len; i++) {
    sg = ref[i];
    res = R.clone(empty);
    if (sg.sources == null) {
      sg.sources = ((ref1 = o.sourcegateRx) != null ? ref1[sg.recipe] : void 0) || [];
    } else if (!R.is(Array, sg.sources)) {
      sg.sources = [sg.sources];
    }
    if (sg.options == null) {
      sg.options = {};
    }
    if (sg.recipe == null) {
      res = [sg.sources, sg.options];
    } else {
      sources = [];
      module = sg.module || o.sourcegateModule;
      prefix = sg.prefix || o.sourcegatePrefix || '';
      preset = sg.preset || o.sourcegatePreset;
      if (preset != null) {
        sources.push(getPreset(sg.recipe, preset, module));
      }
      filerc = sg.recipe === "coffeelint" ? "coffeelint.json" : "." + sg.recipe + "rc";
      config = "" + prefix + filerc;
      if (module) {
        config = "node_modules/" + module + "/" + config;
      }
      config = path.normalize(config);
      if (isThere(config)) {
        if (o.sourcegateWatch) {
          watch.push(config);
        }
        sources.push(config);
      }
      if ((base = sg.options).write == null) {
        base.write = {};
      }
      sg.options.write.path = filerc;
      res = [sources.concat(sg.sources), sg.options];
    }
    ready.push(res);
  }
  if (gulp != null) {
    gulp.task("sourcegate", "Write sourcegate targets.", function() {
      var j, len1, results;
      results = [];
      for (j = 0, len1 = ready.length; j < len1; j++) {
        sg = ready[j];
        results.push(sourcegate.apply(null, sg));
      }
      return results;
    });
    if (o.sourcegateWatch) {
      gulp.task("sourcegate:watch", "Watch sourcegate sources for changes.", function() {
        return gulp.watch(watch, ["sourcegate"]);
      });
    }
  }
  return ready;
};

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5kZXguY29mZmVlIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiaW5kZXguY29mZmVlIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFBQSxJQUFBLDREQUFBOztBQUFBLE9BQUEsQ0FBUSxvQkFBUixDQUE2QixDQUFDLE9BQTlCLENBQUEsQ0FBQSxDQUFBOztBQUFBLENBQ0EsR0FBSSxPQUFBLENBQVEsT0FBUixDQURKLENBQUE7O0FBQUEsRUFFQSxHQUFLLE9BQUEsQ0FBUSxJQUFSLENBRkwsQ0FBQTs7QUFBQSxJQUdBLEdBQU8sT0FBQSxDQUFRLE1BQVIsQ0FIUCxDQUFBOztBQUFBLE9BSUEsR0FBVSxPQUFBLENBQVEsVUFBUixDQUFtQixDQUFDLElBSjlCLENBQUE7O0FBQUEsVUFLQSxHQUFhLE9BQUEsQ0FBUSxZQUFSLENBTGIsQ0FBQTs7QUFBQSxVQU1BLEdBQWEsT0FBQSxDQUFRLHFCQUFSLENBTmIsQ0FBQTs7QUFBQSxHQVVBLEdBQU0sU0FBQyxJQUFELEVBQU8sTUFBUCxHQUFBO0FBQ0osTUFBQSxRQUFBO0FBQUEsRUFBQSxLQUFBLEdBQVEsQ0FDTixlQUFBLEdBQWdCLElBRFYsRUFFTixlQUFBLEdBQWdCLE1BQWhCLEdBQXVCLGdCQUF2QixHQUF1QyxJQUZqQyxDQUFSLENBQUE7QUFLQTtXQUNFLElBQUksQ0FBQyxLQUFMLENBQVcsVUFBQSxDQUFXLEVBQUUsQ0FBQyxZQUFILENBQWdCLElBQUksQ0FBQyxTQUFMLENBQWUsS0FBTSxDQUFBLENBQUEsQ0FBckIsQ0FBaEIsQ0FBd0MsQ0FBQyxRQUF6QyxDQUFBLENBQVgsQ0FBWCxFQURGO0dBQUEsY0FBQTtBQUdFO2FBQ0UsSUFBSSxDQUFDLEtBQUwsQ0FBVyxVQUFBLENBQVcsRUFBRSxDQUFDLFlBQUgsQ0FBZ0IsSUFBSSxDQUFDLFNBQUwsQ0FBZSxLQUFNLENBQUEsQ0FBQSxDQUFyQixDQUFoQixDQUF3QyxDQUFDLFFBQXpDLENBQUEsQ0FBWCxDQUFYLEVBREY7S0FBQSxjQUFBO0FBR0Us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QUFBO1dBQUEseUNBQUE7c0JBQUE7QUFDRSxxQkFBQSxVQUFVLENBQUMsS0FBWCxDQUFpQixJQUFqQixFQUF1QixFQUF2QixFQUFBLENBREY7QUFBQTtxQkFEbUQ7SUFBQSxDQUFyRCxDQUFBLENBQUE7QUFHQSxJQUFBLElBQUcsQ0FBQyxDQUFDLGVBQUw7QUFDRSxNQUFBLElBQUksQ0FBQyxJQUFMLENBQVUsa0JBQVYsRUFDRSx1Q0FERixFQUMyQyxTQUFBLEdBQUE7ZUFDdkMsSUFBSSxDQUFDLEtBQUwsQ0FBVyxLQUFYLEVBQWtCLENBQUMsWUFBRCxDQUFsQixFQUR1QztNQUFBLENBRDNDLENBQUEsQ0FERjtLQUpGO0dBckNBO1NBOENBLE1BL0NlO0FBQUEsQ0EzQ2pCLENBQUEiLCJzb3VyY2VzQ29udGVudCI6WyJyZXF1aXJlKFwic291cmNlLW1hcC1zdXBwb3J0XCIpLmluc3RhbGwoKVxuUiA9IHJlcXVpcmUoXCJyYW1kYVwiKVxuZnMgPSByZXF1aXJlKFwiZnNcIilcbnBhdGggPSByZXF1aXJlKFwicGF0aFwiKVxuaXNUaGVyZSA9IHJlcXVpcmUoXCJpcy10aGVyZVwiKS5zeW5jXG5zb3VyY2VnYXRlID0gcmVxdWlyZShcInNvdXJjZWdhdGVcIilcbm5vY29tbWVudHMgPSByZXF1aXJlKFwic3RyaXAtanNvbi1jb21tZW50c1wiKVxuI2d1dGlsID0gcmVxdWlyZShcImd1bHAtdXRpbFwiKVxuXG5cbmdldCA9ICh3aGF0LCBtb2R1bGUpIC0+XG4gIHdoZXJlID0gW1xuICAgIFwibm9kZV9tb2R1bGVzLyN7d2hhdH1cIixcbiAgICBcIm5vZGVfbW9kdWxlcy8je21vZHVsZX0vbm9kZV9tb2R1bGVzLyN7d2hhdH1cIlxuICBdXG5cbiAgdHJ5XG4gICAgSlNPTi5wYXJzZSBub2NvbW1lbnRzIGZzLnJlYWRGaWxlU3luYyhwYXRoLm5vcm1hbGl6ZSB3aGVyZVswXSkudG9TdHJpbmcoKVxuICBjYXRjaFxuICAgIHRyeVxuICAgICAgSlNPTi5wYXJzZSBub2NvbW1lbnRzIGZzLnJlYWRGaWxlU3luYyhwYXRoLm5vcm1hbGl6ZSB3aGVyZVsxXSkudG9TdHJpbmcoKVxuICAgIGNhdGNoIGVcbiAgICAgIGNvbnNvbGUuZXJyb3IoZSlcbiAgICAgIHRocm93IG5ldyBFcnJvciBcIkNvdWxkIG5vdCBmaW5kIHByZXNldCBhdDogI3t3aGVyZX1cIlxuXG5cbmdldFByZXNldCA9ICh0b29sLCBuYW1lLCBtb2R1bGUpIC0+XG4gIHByZXNldHMgPVxuICAgIGpzY3M6IFwianNjcy9wcmVzZXRzXCIgI3twcmVzZXR9Lmpzb24gd2lsbCBiZSBhcHBlbmRlZFxuICAgIGpzaGludDpcbiAgICAgIGFpcmJuYjogXCJhaXJibmItc3R5bGUvbGludGVycy9qc2hpbnRyY1wiXG4gICAgZXNsaW50OlxuICAgICAgYWlyYm5iOiBcImFpcmJuYi1zdHlsZS9saW50ZXJzL2VzbGludHJjXCJcblxuICBpZiB0b29sIGlzIFwianNjc1wiXG4gICAgZ2V0KFwiI3twcmVzZXRzLmpzY3N9LyN7bmFtZX0uanNvblwiLCBtb2R1bGUpXG4gIGVsc2UgaWYgdG9vbCBpcyBcImNvZmZlZWxpbnRcIiBhbmQgbmFtZSBpcyBcImNvZmZlZXNjcmlwdC1zdHlsZS1ndWlkZVwiXG4gICAgZ2V0KFwiY29mZmVlc2NyaXB0LXN0eWxlLWd1aWRlL2NvZmZlZWxpbnQuanNvblwiLCBtb2R1bGUpXG4gIGVsc2UgaWYgcHJlc2V0c1t0b29sXT9bbmFtZV0/XG4gICAgZ2V0KHByZXNldHNbdG9vbF1bbmFtZV0sIG1vZHVsZSlcbiAgZWxzZSB7fVxuXG5cbm1vZHVsZS5leHBvcnRzID0gKG8gPSB7fSwgZ3VscCkgLT5cbiAgZW1wdHkgPSBbW10sIHt9XVxuICBpZiBSLmlzKEFycmF5LCBvLnNvdXJjZWdhdGUpXG4gICAgaWYgUi5pc0VtcHR5KG8uc291cmNlZ2F0ZSkgdGhlbiByZXR1cm4gW2VtcHR5XVxuICBlbHNlIHJldHVybiBbZW1wdHldICMgb3IgdGhyb3c/XG4gIHJlYWR5ID0gW11cbiAgd2F0Y2ggPSBbXVxuXG4gIGZvciBzZyBpbiBvLnNvdXJjZWdhdGVcbiAgICByZXMgPSBSLmNsb25lKGVtcHR5KVxuICAgIHVubGVzcyBzZy5zb3VyY2VzP1xuICAgICAgc2cuc291cmNlcyA9IG8uc291cmNlZ2F0ZVJ4P1tzZy5yZWNpcGVdIG9yIFtdXG4gICAgZWxzZSB1bmxlc3MgUi5pcyhBcnJheSwgc2cuc291cmNlcylcbiAgICAgIHNnLnNvdXJjZXMgPSBbc2cuc291cmNlc11cbiAgICBzZy5vcHRpb25zID89IHt9XG5cbiAgICB1bmxlc3Mgc2cucmVjaXBlP1xuICAgICAgcmVzID0gW3NnLnNvdXJjZXMsIHNnLm9wdGlvbnNdXG4gICAgZWxzZVxuICAgICAgc291cmNlcyA9IFtdXG4gICAgICBtb2R1bGUgPSBzZy5tb2R1bGUgb3Igby5zb3VyY2VnYXRlTW9kdWxlXG4gICAgICBwcmVmaXggPSBzZy5wcmVmaXggb3Igby5zb3VyY2VnYXRlUHJlZml4IG9yICcnXG4gICAgICBwcmVzZXQgPSBzZy5wcmVzZXQgb3Igby5zb3VyY2VnYXRlUHJlc2V0XG4gICAgICBzb3VyY2VzLnB1c2ggZ2V0UHJlc2V0KHNnLnJlY2lwZSwgcHJlc2V0LCBtb2R1bGUpIGlmIHByZXNldD9cbiAgICAgIGZpbGVyYyA9IGlmIHNnLnJlY2lwZSBpcyBcImNvZmZlZWxpbnRcIiB0aGVuIFwiY29mZmVlbGludC5qc29uXCIgZWxzZSBcIi4je3NnLnJlY2lwZX1yY1wiXG4gICAgICBjb25maWcgPSBcIiN7cHJlZml4fSN7ZmlsZXJjfVwiXG4gICAgICBjb25maWcgPSBcIm5vZGVfbW9kdWxlcy8je21vZHVsZX0vI3tjb25maWd9XCIgaWYgbW9kdWxlXG4gICAgICBjb25maWcgPSBwYXRoLm5vcm1hbGl6ZShjb25maWcpXG4gICAgICBpZiBpc1RoZXJlIGNvbmZpZ1xuICAgICAgICBpZiBvLnNvdXJjZWdhdGVXYXRjaFxuICAgICAgICAgIHdhdGNoLnB1c2ggY29uZmlnXG4gICAgICAgIHNvdXJjZXMucHVzaCBjb25maWdcbiAgICAgIHNnLm9wdGlvbnMud3JpdGUgPz0ge31cbiAgICAgIHNnLm9wdGlvbnMud3JpdGUucGF0aCA9IGZpbGVyY1xuICAgICAgcmVzID0gW3NvdXJjZXMuY29uY2F0KHNnLnNvdXJjZXMpLCBzZy5vcHRpb25zXVxuXG4gICAgcmVhZHkucHVzaCByZXNcblxuICBpZiBndWxwP1xuICAgIGd1bHAudGFzayBcInNvdXJjZWdhdGVcIiwgXCJXcml0ZSBzb3VyY2VnYXRlIHRhcmdldHMuXCIsIC0+XG4gICAgICBmb3Igc2cgaW4gcmVhZHlcbiAgICAgICAgc291cmNlZ2F0ZS5hcHBseShudWxsLCBzZylcbiAgICBpZiBvLnNvdXJjZWdhdGVXYXRjaFxuICAgICAgZ3VscC50YXNrIFwic291cmNlZ2F0ZTp3YXRjaFwiLFxuICAgICAgICBcIldhdGNoIHNvdXJjZWdhdGUgc291cmNlcyBmb3IgY2hhbmdlcy5cIiwgLT5cbiAgICAgICAgICBndWxwLndhdGNoIHdhdGNoLCBbXCJzb3VyY2VnYXRlXCJdXG5cbiAgcmVhZHlcbiJdfQ==